The Hypothetical Portfolio Exercise (HPE) is a component of the Fundamental Review of the Trading Book (FRTB). 
It involves the hypothetical revaluation of a bank's trading book to assess the impact of market risk factors on the value of the portfolio. The results of the HPE are used to determine the market risk capital charge (MRCC) that the bank must hold to cover potential losses in the trading book.


import org.apache.spark.sql.Dataset;
import org.apache.spark.sql.Row;
import org.apache.spark.sql.SparkSession;
import org.apache.spark.sql.types.DataTypes;
import org.apache.spark.sql.types.StructField;
import org.apache.spark.sql.types.StructType;
import java.util.Map;

public class SparkDataProcessor {

    /**
     * Processes the given datasets.
     *
     * @param sparkSession The Spark session to use.
     * @param dsMap A map of dataset names to datasets.
     * @return A processed dataset.
     */
    public Dataset<Row> process(SparkSession sparkSession, Map<String, Dataset<Row>> dsMap) {
        Dataset<Row> inputDataset = dsMap.get("inputDatasetName");
        if (inputDataset != null) {
            // Creating a new column 'mysensitivity' which is 'sensitivity' + 1
            return inputDataset.withColumn(
                "mysensitivity",
                functions.col("sensitivity").plus(1)
            );
        } else {
            // Create a DataFrame schema with a 'mysensitivity' column
            StructType schema = new StructType(new StructField[]{
                DataTypes.createStructField("mysensitivity", DataTypes.DoubleType, true)
            });

            // Create an empty DataFrame with the defined schema
            return sparkSession.createDataFrame(sparkSession.emptyRDD(), schema);
        }
    }
}
